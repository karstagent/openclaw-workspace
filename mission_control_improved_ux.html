<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission Control - Improved UX</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- SortableJS for drag and drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <!-- Heroicons (for icons) -->
    <script src="https://unpkg.com/@heroicons/react@1.0.6/outline/esm/index.js"></script>
    <style>
        .glass {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .glass-dark {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .hover-lift {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }
        
        .ghost {
            opacity: 0.5;
        }
        
        .sortable-drag {
            opacity: 0.8;
        }
        
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        }
        
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
                color: #e2e8f0;
            }
        }
        
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            min-width: 160px;
            z-index: 1;
        }
        
        .dropdown:hover .dropdown-content {
            display: block;
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0,0,0,0.3);
        }
        
        @media (prefers-color-scheme: dark) {
            ::-webkit-scrollbar-track {
                background: rgba(255,255,255,0.05);
            }
            
            ::-webkit-scrollbar-thumb {
                background: rgba(255,255,255,0.2);
            }
            
            ::-webkit-scrollbar-thumb:hover {
                background: rgba(255,255,255,0.3);
            }
        }
    </style>
</head>
<body class="p-4">
    <div class="container mx-auto max-w-7xl">
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-2xl md:text-3xl font-bold">Mission Control</h1>
            <button 
                id="newTaskBtn"
                class="px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition-colors flex items-center space-x-2"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                </svg>
                <span>New Task</span>
            </button>
        </header>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Inbox Column -->
            <div class="glass dark:glass-dark rounded-xl overflow-hidden shadow-lg">
                <div class="bg-blue-500 text-white p-3 flex justify-between items-center">
                    <h2 class="font-semibold text-lg">Inbox</h2>
                    <span class="bg-white text-blue-600 rounded-full text-xs px-2 py-1 task-count" id="inbox-count">0</span>
                </div>
                <div id="inbox-tasks" class="task-container p-3 min-h-[300px] max-h-[70vh] overflow-y-auto" data-status="inbox"></div>
            </div>
            
            <!-- Assigned Column -->
            <div class="glass dark:glass-dark rounded-xl overflow-hidden shadow-lg">
                <div class="bg-yellow-500 text-white p-3 flex justify-between items-center">
                    <h2 class="font-semibold text-lg">Assigned</h2>
                    <span class="bg-white text-yellow-600 rounded-full text-xs px-2 py-1 task-count" id="assigned-count">0</span>
                </div>
                <div id="assigned-tasks" class="task-container p-3 min-h-[300px] max-h-[70vh] overflow-y-auto" data-status="assigned"></div>
            </div>
            
            <!-- In Progress Column -->
            <div class="glass dark:glass-dark rounded-xl overflow-hidden shadow-lg">
                <div class="bg-purple-500 text-white p-3 flex justify-between items-center">
                    <h2 class="font-semibold text-lg">In Progress</h2>
                    <span class="bg-white text-purple-600 rounded-full text-xs px-2 py-1 task-count" id="in-progress-count">0</span>
                </div>
                <div id="in-progress-tasks" class="task-container p-3 min-h-[300px] max-h-[70vh] overflow-y-auto" data-status="in-progress"></div>
            </div>
            
            <!-- Completed Column -->
            <div class="glass dark:glass-dark rounded-xl overflow-hidden shadow-lg">
                <div class="bg-green-500 text-white p-3 flex justify-between items-center">
                    <h2 class="font-semibold text-lg">Completed</h2>
                    <span class="bg-white text-green-600 rounded-full text-xs px-2 py-1 task-count" id="completed-count">0</span>
                </div>
                <div id="completed-tasks" class="task-container p-3 min-h-[300px] max-h-[70vh] overflow-y-auto" data-status="completed"></div>
            </div>
        </div>
        
        <!-- Task Creation Modal -->
        <div id="taskModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="glass dark:glass-dark rounded-xl p-6 max-w-md w-full">
                <h2 class="text-xl font-semibold mb-4" id="modal-title">Create New Task</h2>
                
                <input type="hidden" id="taskId" value="">
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">Task Name</label>
                    <input
                        id="taskName"
                        type="text"
                        class="w-full border border-gray-300 dark:border-gray-700 rounded-lg p-2 bg-white dark:bg-gray-800"
                        placeholder="Enter task name"
                    />
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">Description</label>
                    <textarea
                        id="taskDescription"
                        class="w-full border border-gray-300 dark:border-gray-700 rounded-lg p-2 h-24 bg-white dark:bg-gray-800"
                        placeholder="Enter task description"
                    ></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">Assign To</label>
                    <select
                        id="taskAssingee"
                        class="w-full border border-gray-300 dark:border-gray-700 rounded-lg p-2 bg-white dark:bg-gray-800"
                    >
                        <option value="">Unassigned</option>
                        <option value="pip">Pip</option>
                        <option value="jordan">Jordan</option>
                    </select>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium mb-1">Priority</label>
                        <select
                            id="taskPriority"
                            class="w-full border border-gray-300 dark:border-gray-700 rounded-lg p-2 bg-white dark:bg-gray-800"
                        >
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-1">Due Date</label>
                        <input 
                            type="date" 
                            id="taskDueDate"
                            class="w-full border border-gray-300 dark:border-gray-700 rounded-lg p-2 bg-white dark:bg-gray-800"
                        >
                    </div>
                </div>
                
                <div class="flex justify-end space-x-2">
                    <button
                        id="deleteTaskBtn"
                        class="px-4 py-2 bg-red-500 text-white rounded-lg hidden"
                    >
                        Delete
                    </button>
                    <button
                        id="cancelTaskBtn"
                        class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg"
                    >
                        Cancel
                    </button>
                    <button
                        id="saveTaskBtn"
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg"
                    >
                        Create Task
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Task Quick View Modal -->
        <div id="taskViewModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="glass dark:glass-dark rounded-xl p-6 max-w-md w-full">
                <div class="flex justify-between items-start mb-4">
                    <h2 class="text-xl font-semibold" id="view-title"></h2>
                    <div class="flex space-x-2">
                        <button id="editTaskBtn" class="p-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                            </svg>
                        </button>
                        <button id="closeViewBtn" class="p-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="mb-4">
                    <span id="view-priority" class="inline-block px-2 py-1 rounded-full text-xs mb-2"></span>
                    <p id="view-description" class="text-gray-600 dark:text-gray-300 whitespace-pre-wrap"></p>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <span class="text-sm text-gray-500 dark:text-gray-400">Assignee</span>
                        <p id="view-assignee">-</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500 dark:text-gray-400">Due Date</span>
                        <p id="view-due-date">-</p>
                    </div>
                </div>
                
                <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mb-4">
                    <span class="text-sm text-gray-500 dark:text-gray-400">Created</span>
                    <p id="view-created-at"></p>
                </div>
                
                <div class="flex justify-between">
                    <div>
                        <input type="hidden" id="view-task-id" value="">
                    </div>
                    <div class="flex space-x-2">
                        <button id="moveTaskBtn" class="px-3 py-1 bg-blue-600 text-white text-sm rounded-lg">Move Task</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Move Task Modal -->
        <div id="moveTaskModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="glass dark:glass-dark rounded-xl p-6 max-w-sm w-full">
                <h2 class="text-xl font-semibold mb-4">Move Task</h2>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">Move To</label>
                    <select
                        id="moveToStatus"
                        class="w-full border border-gray-300 dark:border-gray-700 rounded-lg p-2 bg-white dark:bg-gray-800"
                    >
                        <option value="inbox">Inbox</option>
                        <option value="assigned">Assigned</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                
                <div class="flex justify-end space-x-2">
                    <button
                        id="cancelMoveBtn"
                        class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg"
                    >
                        Cancel
                    </button>
                    <button
                        id="confirmMoveBtn"
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg"
                    >
                        Move
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Task data structure
        const getTasks = () => {
            try {
                return JSON.parse(localStorage.getItem('mission-control-tasks')) || [];
            } catch (e) {
                console.error('Error loading tasks', e);
                return [];
            }
        };
        
        const saveTasks = (tasks) => {
            localStorage.setItem('mission-control-tasks', JSON.stringify(tasks));
        };
        
        // Format date for display
        const formatDate = (dateString) => {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString();
        };
        
        // Get color class based on priority
        const getPriorityColors = (priority) => {
            switch(priority) {
                case 'low':
                    return {
                        bg: 'bg-blue-100 dark:bg-blue-900',
                        text: 'text-blue-800 dark:text-blue-200'
                    };
                case 'medium':
                    return {
                        bg: 'bg-yellow-100 dark:bg-yellow-900',
                        text: 'text-yellow-800 dark:text-yellow-200'
                    };
                case 'high':
                    return {
                        bg: 'bg-orange-100 dark:bg-orange-900',
                        text: 'text-orange-800 dark:text-orange-200'
                    };
                case 'urgent':
                    return {
                        bg: 'bg-red-100 dark:bg-red-900',
                        text: 'text-red-800 dark:text-red-200'
                    };
                default:
                    return {
                        bg: 'bg-gray-100 dark:bg-gray-700',
                        text: 'text-gray-800 dark:text-gray-200'
                    };
            }
        };
        
        // Render all tasks
        const renderTasks = () => {
            const tasks = getTasks();
            
            // Get all columns
            const columns = {
                inbox: document.getElementById('inbox-tasks'),
                assigned: document.getElementById('assigned-tasks'),
                'in-progress': document.getElementById('in-progress-tasks'),
                completed: document.getElementById('completed-tasks')
            };
            
            // Clear all task containers
            for (const status in columns) {
                columns[status].innerHTML = '';
            }
            
            // Sort tasks by creation date (newest first)
            tasks.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            // Group tasks by status
            const tasksByStatus = {
                inbox: [],
                assigned: [],
                'in-progress': [],
                completed: []
            };
            
            tasks.forEach(task => {
                const status = task.status || 'inbox';
                if (tasksByStatus[status]) {
                    tasksByStatus[status].push(task);
                } else {
                    tasksByStatus['inbox'].push(task);
                }
            });
            
            // Update counts
            for (const status in tasksByStatus) {
                const countEl = document.getElementById(`${status}-count`);
                if (countEl) {
                    countEl.textContent = tasksByStatus[status].length;
                }
            }
            
            // Render tasks in their respective columns
            for (const status in tasksByStatus) {
                const container = columns[status];
                
                tasksByStatus[status].forEach(task => {
                    const { bg: priorityBg, text: priorityText } = getPriorityColors(task.priority);
                    
                    const taskEl = document.createElement('div');
                    taskEl.className = 'glass dark:glass-dark rounded-lg p-3 mb-3 hover-lift cursor-pointer';
                    taskEl.dataset.id = task.id;
                    
                    const assignedTo = task.assignee ? 
                        `<div class="flex items-center mt-2">
                            <span class="text-xs text-gray-500 dark:text-gray-400">Assigned to: </span>
                            <span class="ml-1 text-xs font-medium">${task.assignee}</span>
                        </div>` : '';
                    
                    const dueDate = task.dueDate ? 
                        `<div class="flex items-center mt-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                            </svg>
                            <span class="ml-1 text-xs text-gray-500 dark:text-gray-400">${formatDate(task.dueDate)}</span>
                        </div>` : '';
                    
                    taskEl.innerHTML = `
                        <div class="flex justify-between items-start">
                            <h3 class="font-medium">${task.title}</h3>
                            <span class="inline-block text-xs px-2 py-0.5 rounded-full ${priorityBg} ${priorityText} capitalize">${task.priority}</span>
                        </div>
                        ${task.description ? `<p class="text-sm text-gray-600 dark:text-gray-300 mt-1 line-clamp-2">${task.description}</p>` : ''}
                        <div class="mt-2 flex items-center justify-between">
                            ${assignedTo}
                            ${dueDate}
                        </div>
                    `;
                    
                    // Open task view on click
                    taskEl.addEventListener('click', () => openTaskView(task));
                    
                    container.appendChild(taskEl);
                });
            }
            
            // Initialize SortableJS for each column
            for (const status in columns) {
                if (window.sortables && window.sortables[status]) {
                    window.sortables[status].destroy();
                }
            }
            
            if (!window.sortables) {
                window.sortables = {};
            }
            
            for (const status in columns) {
                window.sortables[status] = new Sortable(columns[status], {
                    group: 'tasks',
                    animation: 150,
                    ghostClass: 'ghost',
                    onEnd: function(evt) {
                        if (evt.to === evt.from && evt.oldIndex === evt.newIndex) {
                            return;
                        }
                        
                        const taskId = evt.item.dataset.id;
                        const newStatus = evt.to.dataset.status;
                        
                        // Update task status
                        const tasks = getTasks();
                        const taskIndex = tasks.findIndex(t => t.id === taskId);
                        
                        if (taskIndex !== -1) {
                            tasks[taskIndex].status = newStatus;
                            saveTasks(tasks);
                            renderTasks();
                        }
                    }
                });
            }
        };
        
        // Modal functionality
        const taskModal = document.getElementById('taskModal');
        const taskViewModal = document.getElementById('taskViewModal');
        const moveTaskModal = document.getElementById('moveTaskModal');
        const newTaskBtn = document.getElementById('newTaskBtn');
        const cancelTaskBtn = document.getElementById('cancelTaskBtn');
        const saveTaskBtn = document.getElementById('saveTaskBtn');
        const deleteTaskBtn = document.getElementById('deleteTaskBtn');
        const closeViewBtn = document.getElementById('closeViewBtn');
        const editTaskBtn = document.getElementById('editTaskBtn');
        const moveTaskBtn = document.getElementById('moveTaskBtn');
        const cancelMoveBtn = document.getElementById('cancelMoveBtn');
        const confirmMoveBtn = document.getElementById('confirmMoveBtn');
        
        // Open create task modal
        newTaskBtn.addEventListener('click', () => {
            // Reset form
            document.getElementById('taskId').value = '';
            document.getElementById('taskName').value = '';
            document.getElementById('taskDescription').value = '';
            document.getElementById('taskPriority').value = 'medium';
            document.getElementById('taskAssingee').value = '';
            document.getElementById('taskDueDate').value = '';
            
            // Update modal title and button
            document.getElementById('modal-title').textContent = 'Create New Task';
            saveTaskBtn.textContent = 'Create Task';
            
            // Hide delete button
            deleteTaskBtn.classList.add('hidden');
            
            // Show modal
            taskModal.classList.remove('hidden');
            setTimeout(() => document.getElementById('taskName').focus(), 100);
        });
        
        // Close task modal
        cancelTaskBtn.addEventListener('click', () => {
            taskModal.classList.add('hidden');
        });
        
        // Save task (create or update)
        saveTaskBtn.addEventListener('click', () => {
            const taskId = document.getElementById('taskId').value;
            const taskName = document.getElementById('taskName').value.trim();
            
            if (!taskName) {
                alert('Please enter a task name');
                return;
            }
            
            const taskDescription = document.getElementById('taskDescription').value.trim();
            const taskPriority = document.getElementById('taskPriority').value;
            const taskAssignee = document.getElementById('taskAssingee').value;
            const taskDueDate = document.getElementById('taskDueDate').value;
            
            const tasks = getTasks();
            
            if (taskId) {
                // Update existing task
                const taskIndex = tasks.findIndex(t => t.id === taskId);
                
                if (taskIndex !== -1) {
                    tasks[taskIndex] = {
                        ...tasks[taskIndex],
                        title: taskName,
                        description: taskDescription,
                        priority: taskPriority,
                        assignee: taskAssignee,
                        dueDate: taskDueDate,
                        updatedAt: new Date().toISOString()
                    };
                    
                    saveTasks(tasks);
                    taskModal.classList.add('hidden');
                    renderTasks();
                }
            } else {
                // Create new task
                const task = {
                    id: Date.now().toString(),
                    title: taskName,
                    description: taskDescription,
                    status: 'inbox',
                    priority: taskPriority,
                    assignee: taskAssignee,
                    dueDate: taskDueDate,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                tasks.push(task);
                saveTasks(tasks);
                taskModal.classList.add('hidden');
                renderTasks();
            }
        });
        
        // Delete task
        deleteTaskBtn.addEventListener('click', () => {
            const taskId = document.getElementById('taskId').value;
            
            if (taskId && confirm('Are you sure you want to delete this task?')) {
                const tasks = getTasks();
                const updatedTasks = tasks.filter(t => t.id !== taskId);
                
                saveTasks(updatedTasks);
                taskModal.classList.add('hidden');
                renderTasks();
            }
        });
        
        // Open task view
        function openTaskView(task) {
            document.getElementById('view-task-id').value = task.id;
            document.getElementById('view-title').textContent = task.title;
            document.getElementById('view-description').textContent = task.description || 'No description';
            
            // Set priority badge
            const { bg: priorityBg, text: priorityText } = getPriorityColors(task.priority);
            const priorityEl = document.getElementById('view-priority');
            priorityEl.className = `${priorityBg} ${priorityText} inline-block px-2 py-1 rounded-full text-xs mb-2 capitalize`;
            priorityEl.textContent = task.priority;
            
            // Set assignee and due date
            document.getElementById('view-assignee').textContent = task.assignee || '-';
            document.getElementById('view-due-date').textContent = formatDate(task.dueDate);
            
            // Set created date
            document.getElementById('view-created-at').textContent = formatDate(task.createdAt);
            
            // Show view modal
            taskViewModal.classList.remove('hidden');
        }
        
        // Close task view
        closeViewBtn.addEventListener('click', () => {
            taskViewModal.classList.add('hidden');
        });
        
        // Edit task from view
        editTaskBtn.addEventListener('click', () => {
            const taskId = document.getElementById('view-task-id').value;
            const tasks = getTasks();
            const task = tasks.find(t => t.id === taskId);
            
            if (task) {
                // Fill form with task data
                document.getElementById('taskId').value = task.id;
                document.getElementById('taskName').value = task.title;
                document.getElementById('taskDescription').value = task.description || '';
                document.getElementById('taskPriority').value = task.priority || 'medium';
                document.getElementById('taskAssingee').value = task.assignee || '';
                document.getElementById('taskDueDate').value = task.dueDate || '';
                
                // Update modal title and button
                document.getElementById('modal-title').textContent = 'Edit Task';
                saveTaskBtn.textContent = 'Save Changes';
                
                // Show delete button
                deleteTaskBtn.classList.remove('hidden');
                
                // Close view modal and open edit modal
                taskViewModal.classList.add('hidden');
                taskModal.classList.remove('hidden');
            }
        });
        
        // Open move task modal
        moveTaskBtn.addEventListener('click', () => {
            const taskId = document.getElementById('view-task-id').value;
            const tasks = getTasks();
            const task = tasks.find(t => t.id === taskId);
            
            if (task) {
                // Set current status
                document.getElementById('moveToStatus').value = task.status || 'inbox';
                
                // Show move modal and hide view modal
                taskViewModal.classList.add('hidden');
                moveTaskModal.classList.remove('hidden');
            }
        });
        
        // Cancel move
        cancelMoveBtn.addEventListener('click', () => {
            moveTaskModal.classList.add('hidden');
        });
        
        // Confirm move
        confirmMoveBtn.addEventListener('click', () => {
            const taskId = document.getElementById('view-task-id').value;
            const newStatus = document.getElementById('moveToStatus').value;
            
            if (taskId) {
                const tasks = getTasks();
                const taskIndex = tasks.findIndex(t => t.id === taskId);
                
                if (taskIndex !== -1) {
                    tasks[taskIndex].status = newStatus;
                    tasks[taskIndex].updatedAt = new Date().toISOString();
                    
                    saveTasks(tasks);
                    moveTaskModal.classList.add('hidden');
                    renderTasks();
                }
            }
        });
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            renderTasks();
            
            // Create sample tasks if none exist
            const tasks = getTasks();
            if (tasks.length === 0) {
                const sampleTasks = [
                    {
                        id: '1',
                        title: 'Welcome to Mission Control',
                        description: 'This is a sample task to get you started. You can edit, move, or delete it.\n\nFeatures:\n- Drag and drop between columns\n- Edit tasks\n- Set due dates and priorities\n- Assign tasks to team members',
                        status: 'inbox',
                        priority: 'medium',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];
                saveTasks(sampleTasks);
                renderTasks();
            }
        });
        
        // Ensure tasks render even if DOMContentLoaded already fired
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', renderTasks);
        } else {
            renderTasks();
        }
        
        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === taskModal) {
                taskModal.classList.add('hidden');
            } else if (e.target === taskViewModal) {
                taskViewModal.classList.add('hidden');
            } else if (e.target === moveTaskModal) {
                moveTaskModal.classList.add('hidden');
            }
        });
    </script>
</body>
</html>